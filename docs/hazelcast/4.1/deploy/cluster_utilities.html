<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cluster Utilities Hazelcast Documentation</title>
    <link rel="canonical" href="https://JakeSCahill.github.io/hazelcast/4.1/deploy/cluster_utilities.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://JakeSCahill.github.io">Hazelcast Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Use cases</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">GitHub</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../develop/hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="management.html">Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../home/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../hazelcast_overview.html">Hazelcast IMDG</a></li>
    <li><a href="cluster_utilities.html">Cluster Utilities</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a class="git" href="file:///C:/Users/Jake%20Cahill/Documents/code-playground/docs/hazelcast-docs/modules/deploy/pages/cluster_utilities.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Cluster Utilities</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information on the Hazelcast command line and
other programmatic utilities you can use to listen to
the cluster events, to change the state of your cluster,
to check whether the cluster and/or members are safe before shutting down a member and
to define the minimum number of cluster members required for the cluster to remain up and running.
It also gives information on the Hazelcast Lite Member.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_tab-1-title"></a>Tab 1 Title</p>
</li>
<li>
<p><a id="tabset1_tab-2-title"></a>Tab 2 Title</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_tab-1-title">
<div class="paragraph">
<p>This is the content of the first tab.</p>
</div>
<div class="paragraph">
<p>Another paragraph in the first tab.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ a code block</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_tab-2-title">
<div class="paragraph">
<p>This is the content of the second tab.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hazelcast_command_line_tool"><a class="anchor" href="#_hazelcast_command_line_tool"></a>Hazelcast Command Line Tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a tool using which you can install and run Hazelcast IMDG and Management Center
on your Unix-like local environments. You need <a href="https://www.oracle.com/java/technologies/javase-downloads.html" target="_blank" rel="noopener">JRE 8 or newer</a>
as a prerequisite.</p>
</div>
<div class="paragraph">
<p>This tool comes with your Hazelcast IMDG download package.
When you extract the package, you see the "hazelcast-command-line" directory.</p>
</div>
<div class="paragraph">
<p>To install and start using the tool, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following commands in the extracted IMDG directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cd hazelcast-command-line/distro
$ make</code></pre>
</div>
</div>
</li>
<li>
<p>When the <code>make</code> command finishes, run the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cd build/dist/bin
$ ./hz</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You are now ready to use the tool.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Starting a standalone Hazelcast member with the default configuration:</strong></p>
<div class="paragraph">
<p><code>$ ./hz start</code>
*</p>
</div>
</li>
<li>
<p><strong>Starting Hazelcast Management Center:</strong></p>
<div class="paragraph">
<p><code>$ ./hz mc start</code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please see the tool&#8217;s <a href="https://github.com/hazelcast/hazelcast-command-line" target="_blank" rel="noopener">documentation</a>
for all the other usages.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-script-cluster-sh"><a class="anchor" href="#using-the-script-cluster-sh"></a>Using the cluster.sh Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the script <code>cluster.sh</code>, which comes with the Hazelcast package, to
get/change the state of your cluster, to shutdown your cluster and
to force your cluster to clean its persisted data and make a fresh start.
The latter is the Force Start operation of Hazelcast&#8217;s Hot Restart Persistence feature.
See the <a href="#force-start">Force Start section</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The script <code>cluster.sh</code> uses <code>curl</code> command and <code>curl</code> must be installed to be able to use the script.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script <code>cluster.sh</code> takes the following parameters to operate according to your needs.
If these parameters are not provided, the default values are used.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code> or <code>--operation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get-state</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Executes a cluster-wide operation. Operations can be the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IMDG Open Source operations: <code>get-state</code>, <code>change-state</code>, <code>shutdown</code> and <code>get-cluster-version</code>.</p>
</li>
<li>
<p>IMDG Enterprise operations: <code>force-start</code>, <code>partial-start</code> and <code>change-cluster-version</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code> or <code>--state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Updates the state of the cluster to a new state. New state can be <code>active</code>,
<code>no_migration</code>, <code>frozen</code>, <code>passive</code>. This is used with the operation <code>change-state</code>.
This parameter has no default value; when you use this, you should provide a valid state.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code> or <code>--address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the IP address of a cluster member. If you want to manage your cluster remotely,
you should use this parameter to provide the IP address of a member to this script.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code> or <code>--port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5701</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines on which port Hazelcast is running on the local or remote machine.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code> or <code>--clustername</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the name of a cluster which is used for a simple authentication.
See the <a href="#creating-cluster">Creating Clusters section</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code> or <code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev-pass</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the password of a cluster (valid only for Hazelcast releases older than 3.8.2).
See the <a href="#creating-cluster">Creating Clusters section</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code> or <code>--version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no argument expected</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the cluster version to change to. It is used in conjunction with
the <code>change-cluster-version</code> operation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code> or <code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no argument expected</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Prints error output.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--https</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no argument expected</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Uses HTTPS protocol for REST calls.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cacert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>set of well-known CA certificates</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines trusted PEM-encoded certificate file path. It&#8217;s used to verify member certificates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines PEM-encoded client certificate file path. Only needed when client certificate authentication is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines PEM-encoded client private key file path. Only needed when client certificate authentication is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--insecure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no argument expected</em></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Disables member certificate verification.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The script <code>cluster.sh</code> is self-documented; you can see the parameter descriptions using
the command <code>./cluster.sh -h</code> or <code>./cluster.sh --help</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can perform the above operations using the Hot Restart tab of Hazelcast Management Center or
using the REST API. See the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart" target="_blank" rel="noopener">Hot Restart</a>
and <a href="#using-rest-api-for-cluster-management">Using REST API for Cluster Management</a> sections
in the Hazelcast Management Center Reference Manual.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_example_usages_for_cluster_sh"><a class="anchor" href="#_example_usages_for_cluster_sh"></a>Example Usages for cluster.sh</h3>
<div class="paragraph">
<p>Let&#8217;s say you have a cluster running on remote machines and one Hazelcast member is running on the IP <code>172.16.254.1</code> and on the port
<code>5702</code>. The cluster name and password of the cluster are <code>test</code> and <code>test</code>.</p>
</div>
<div class="paragraph">
<p><strong>Getting the cluster state:</strong></p>
</div>
<div class="paragraph">
<p>To get the state of the cluster, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o get-state -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>The following also gets the cluster state, using the alternative parameter names, e.g., <code>--port</code> instead of <code>-p</code>:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation get-state --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Changing the cluster state:</strong></p>
</div>
<div class="paragraph">
<p>To change the state of the cluster to <code>frozen</code>, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o change-state -s frozen -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation change-state --state frozen --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Shutting down the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To shutdown the cluster, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o shutdown -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation shutdown --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Partial starting the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To partial start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o partial-start -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation partial-start --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Force starting the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To force start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o force-start -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation force-start --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Getting the current cluster version:</strong></p>
</div>
<div class="paragraph">
<p>To get the cluster version, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o get-cluster-version -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>The following also gets the cluster state, using the alternative parameter names, e.g., <code>--port</code> instead of <code>-p</code>:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh --operation get-cluster-version --address 172.16.254.1 --port 5702 --clustername test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Changing the cluster version:</strong></p>
</div>
<div class="paragraph">
<p>See the <a href="#rolling-member-upgrades">Rolling Member Upgrades chapter</a> to learn more about the cases when you should change the cluster version.</p>
</div>
<div class="paragraph">
<p>To change the cluster version to <code>X.Y</code>, use the following command:</p>
</div>
<div class="paragraph">
<p><code>./cluster.sh -o change-cluster-version -v X.Y -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>The cluster version is always in the <code>major.minor</code> format, e.g., 3.12. Using other formats results in a failure.</p>
</div>
<div class="paragraph">
<p><strong>Calls against the TLS protected members (using HTTPS protocol):</strong></p>
</div>
<div class="paragraph">
<p>When the member has TLS configured, use the <code>--https</code> argument to instruct <code>cluster.sh</code> to use the proper URL scheme:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./cluster.sh --https \
  --operation get-state --address member1.example.com --port 5701</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the default set of trusted certificate authorities is not sufficient, e.g, you use a self-signed certificate,
you can provide a custom file with the root certificates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./cluster.sh --https \
  --cacert /path/to/ca-certs.pem \
  --operation get-state --address member1.example.com --port 5701</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the TLS mutual authentication is enabled, you have to provide the client certificate and related private key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./cluster.sh --https \
  --key privkey.pem \
  --cert cert.pem \
  --operation get-state --address member1.example.com --port 5701</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, this script is not supported on the Windows platforms.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_rest_api_for_cluster_management"><a class="anchor" href="#_using_rest_api_for_cluster_management"></a>Using REST API for Cluster Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Besides the Management Center&#8217;s Hot Restart
<a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart" target="_blank" rel="noopener">tab</a> and
the script <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a>, you can also use REST API to manage your cluster&#8217;s state.
The following are the operations you can perform.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some of the REST calls listed below need their REST endpoint groups to be enabled.
See the <a href="#using-the-rest-endpoint-groups">Using the REST Endpoint Groups section</a> on how to enable them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note that the value of <code>${PASSWORD}</code> in the following calls is checked only if
the security is <a href="#enabling-jaas-security">enabled</a> in Hazelcast IMDG, i.e., if you have Hazelcast IMDG Enterprise Edition.
If the security is disabled, the <code>${PASSWORD}</code> can be left empty.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. REST API calls</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>IMDG Open Source commands</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Checking if a member is ready to be used:</em></p>
<div class="paragraph">
<p>When a member joins the cluster, you can check whether it is ready to be used with the following HTTP call.
It should return the <code>200</code> status code, meaning that the member can be safely used.
Otherwise, it returns the <code>503</code> status code indicating the member is not available yet.
Only HTTP GET request method is supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl http://127.0.0.1:${PORT}/hazelcast/health/ready</code></pre>
</div>
</div>
</li>
<li>
<p><em>Getting the cluster state:</em></p>
<div class="paragraph">
<p>To get the state of the cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/state</code></pre>
</div>
</div>
</li>
<li>
<p><em>Changing the cluster state:</em></p>
<div class="paragraph">
<p>To change the state of the cluster to <code>frozen</code>, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}&amp;${STATE}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/changeState</code></pre>
</div>
</div>
</li>
<li>
<p><em>Shutting down the cluster:</em></p>
<div class="paragraph">
<p>To shutdown the cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}"  http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/clusterShutdown</code></pre>
</div>
</div>
</li>
<li>
<p><em>Querying the current cluster version:</em></p>
<div class="paragraph">
<p>To get the current cluster version, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">$ curl http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/version
  {"status":"success","version":"3.9"}</code></pre>
</div>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>IMDG Enterprise commands</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Partial starting the cluster:</em></p>
<div class="paragraph">
<p>To partial start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/partialStart/</code></pre>
</div>
</div>
</li>
<li>
<p><em>Force starting the cluster:</em></p>
<div class="paragraph">
<p>To force start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/forceStart/</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also perform the above operations (partialStart and forceStart) using
the Hot Restart tab of Hazelcast Management Center or using the script <code>cluster.sh</code>.
See the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart" target="_blank" rel="noopener">Hot Restart</a>
and <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a> sections.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><em>Initiating Hot Backup:</em></p>
<div class="paragraph">
<p>To initiate the Hot Backup, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/hotBackup</code></pre>
</div>
</div>
</li>
<li>
<p><em>Changing the cluster version:</em></p>
<div class="paragraph">
<p>To upgrade the cluster version, after having upgraded all members of your cluster to
a new minor version, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">$ curl --data "${CLUSTERNAME}&amp;$\{PASSWORD}&amp;${CLUSTER_VERSION}" http://127.0.0.1:${PORT}/hazelcast/rest/management/cluster/version</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, assuming the default cluster name and password, issue the following command to any member
of the cluster to upgrade from cluster version 3.8 to 3.9:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">$ curl --data "dev&amp;dev-pass&amp;3.9" http://127.0.0.1:5701/hazelcast/rest/management/cluster/version
  {"status":"success","version":"3.9"}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also perform the above cluster version operations using Hazelcast Management Center
or using the script <code>cluster.sh</code>. See the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#rolling-upgrade" target="_blank" rel="noopener">Rolling Member Upgrades</a>
and <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a> sections.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_lite_members"><a class="anchor" href="#_enabling_lite_members"></a>Enabling Lite Members</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lite members are the Hazelcast cluster members that do not store data.
These members are used mainly to execute tasks and register listeners and they do not have partitions.</p>
</div>
<div class="paragraph">
<p>You can form your cluster to include the regular Hazelcast members to store data and
Hazelcast lite members to run heavy computations.
The presence of the lite members do not affect the operations performed on the other members in the cluster.
You can directly submit your tasks to the lite members, register listeners on them and invoke operations for
the Hazelcast data structures on them such as <code>map.put()</code> and <code>map.get()</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you want to use lite members in a Hazelcast IMDG Enterprise
cluster, they are also subjected to the Enterprise license.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuring_lite_members"><a class="anchor" href="#_configuring_lite_members"></a>Configuring Lite Members</h3>
<div class="paragraph">
<p>You can enable a cluster member to be a lite member using declarative or programmatic configuration.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;lite-member enabled="true"/&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  lite-member:
    enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config config = new Config();
config.setLiteMember(true);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_promoting_lite_members_to_data_member"><a class="anchor" href="#_promoting_lite_members_to_data_member"></a>Promoting Lite Members to Data Member</h3>
<div class="paragraph">
<p>Lite members can be promoted to data members using the <code>Cluster</code> interface.
When they are promoted, cluster partitions are rebalanced and ownerships of some portion of
the partitions are assigned to the newly promoted data members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config config = new Config();
config.setLiteMember(true);

HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance(config);
Cluster cluster = hazelcastInstance.getCluster();
cluster.promoteLocalLiteMember();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A data member cannot be downgraded to a lite member back.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_member_events_and_member_sets"><a class="anchor" href="#_getting_member_events_and_member_sets"></a>Getting Member Events and Member Sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast allows you to register for membership events so that you are notified when
members are added or removed. You can also get the set of cluster members.</p>
</div>
<div class="paragraph">
<p>The following example code does the above: registers for member events,
notifies when members are added or removed and gets the set of cluster members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleGetMemberEventsAndSets {

    public static void main(String[] args) {
        HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
        Cluster cluster = hazelcastInstance.getCluster();
        cluster.addMembershipListener( new MembershipListener() {
            public void memberAdded( MembershipEvent membershipEvent ) {
                System.out.println( "MemberAdded " + membershipEvent );
            }

            public void memberRemoved( MembershipEvent membershipEvent ) {
                System.out.println( "MemberRemoved " + membershipEvent );
            }
        } );

        Member localMember  = cluster.getLocalMember();
        System.out.println ( "my inetAddress= " + localMember.getInetAddress() );

        Set setMembers  = cluster.getMembers();
        for ( Member member : setMembers ) {
            System.out.println( "isLocalMember " + member.localMember() );
            System.out.println( "member.inetaddress " + member.getInetAddress() );
            System.out.println( "member.port " + member.getPort() );
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See the <a href="#listening-for-member-events">Membership Listener section</a>
for more information on membership events.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_cluster_and_member_states"><a class="anchor" href="#_managing_cluster_and_member_states"></a>Managing Cluster and Member States</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the states of Hazelcast clusters and members which
you can use to allow or restrict the designated cluster/member operations.</p>
</div>
<div class="sect2">
<h3 id="_cluster_states"><a class="anchor" href="#_cluster_states"></a>Cluster States</h3>
<div class="paragraph">
<p>By changing the state of your cluster, you can allow/restrict several
cluster operations or change the behavior of those operations.
You can use the methods <code>changeClusterState()</code> and <code>shutdown()</code> which are in the
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/cluster/Cluster.html" target="_blank" rel="noopener">Cluster interface</a> to change your cluster&#8217;s state.</p>
</div>
<div class="paragraph">
<p>Hazelcast clusters have the following states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ACTIVE</code></strong>: This is the default cluster state. Cluster continues to operate without restrictions.</p>
</li>
<li>
<p><strong><code>NO_MIGRATION</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, there is no data movement between Hazelcast members.
It means that when there is a member crash or a new member in the cluster,
there won’t be any partition rebalancing, partition backup replica creation
or migration.</p>
<div class="paragraph">
<p>Please note that promoting a backup replica to the primary replica is a
local operation and does not involve any data movement between cluster members.
Hence, backup promotions occur on member crashes when the cluster is in this mode.
Upon a member crash, all other members that keep backup replicas of the crashed member
promote backup replicas to the primary replica role and restore availability.
However, there is a limitation here. Since the maximum number of backups is 6,
if you lose 7 members in your large cluster, you can lose availability of the
partitions whose primary and backup replicas are mapped to those crashed members.</p>
</div>
</li>
<li>
<p>The cluster accepts new members.</p>
</li>
<li>
<p>All other operations are allowed.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>NO_MIGRATION</code> when
migration/replication tasks are being performed.</p>
</li>
<li>
<p>When you want to add multiple new members to the cluster, you can first
change the cluster state to <code>NO_MIGRATION</code>, then start the new members.
Once all of them join to the cluster, you can change the cluster state back to <code>ACTIVE</code>.
Then, the cluster rebalances partition replica distribution at once.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>FROZEN</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, the partition table is frozen and partition assignments are not performed.</p>
</li>
<li>
<p>The cluster does not accept new members.</p>
</li>
<li>
<p>If a member leaves, it can join back. Its partition assignments
(both primary and backup replicas) remain the same until either it joins back or
the cluster state is changed to <code>ACTIVE</code>. When it joins back to the cluster,
it owns all previous partition assignments as it was. On the other hand,
when the cluster state changes to <code>ACTIVE</code>, re-partitioning starts and
unassigned partition replicas are assigned to the active members.</p>
</li>
<li>
<p>All other operations in the cluster, except migration, continue without restrictions.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>FROZEN</code> when migration/replication tasks are being performed.</p>
</li>
<li>
<p>You can make use of <code>FROZEN</code> state along with the <a href="#hot-restart-persistence">Hot Restart Persistence</a>
feature. You can change the cluster state to <code>FROZEN</code>, then restart some of your members using
the Hot Restart feature. The data on the restarting members will not be accessible but
you will be able to access to the data that is stored in other members.
Basically, <code>FROZEN</code> cluster state allows you do perform maintenance on your members with degrading availability partially.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>PASSIVE</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, the partition table is frozen and partition assignments are not performed.</p>
</li>
<li>
<p>The cluster does not accept new members.</p>
</li>
<li>
<p>If a member leaves while the cluster is in this state, the member will be
removed from the partition table if cluster state moves back to <code>ACTIVE</code>.</p>
</li>
<li>
<p>This state rejects ALL operations immediately EXCEPT the read-only operations like
<code>map.get()</code> and <code>cache.get()</code>, replication and cluster heartbeat tasks.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>PASSIVE</code> when migration/replication tasks are being performed.</p>
</li>
<li>
<p>You can make use of <code>PASSIVE</code> state along with the <a href="#hot-restart-persistence">Hot Restart Persistence</a>
feature. See the <a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/cluster/Cluster.html#shutdown--" target="_blank" rel="noopener">Cluster Shutdown API</a>
for more info.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>IN_TRANSITION</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>This state shows that the state of the cluster is in transition.</p>
</li>
<li>
<p>You cannot set your cluster&#8217;s state as <code>IN_TRANSITION</code> explicitly.</p>
</li>
<li>
<p>It is a temporary and intermediate state.</p>
</li>
<li>
<p>During this state, your cluster does not accept new members and migration/replication tasks are paused.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All in-cluster methods are fail-fast, i.e., when a method fails in the cluster,
it throws an exception immediately (it is not retried): when there is an error during a state transition,
that error is propagated immediately, Hazelcast does not attempt to retry the transition in this case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following snippet is from the <code>Cluster</code> interface showing
the methods used to manage your cluster&#8217;s states.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Cluster {
    ClusterState getClusterState();
    void changeClusterState(ClusterState newState);
    void changeClusterState(ClusterState newState, TransactionOptions transactionOptions);
    void shutdown();
    void shutdown(TransactionOptions transactionOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/cluster/Cluster.html" target="_blank" rel="noopener">Cluster interface Javadoc</a> for information on these methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_member_states"><a class="anchor" href="#_cluster_member_states"></a>Cluster Member States</h3>
<div class="paragraph">
<p>Hazelcast cluster members have the following states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ACTIVE</code></strong>: This is the initial member state. The member can execute and process
all operations. When the state of the cluster is <code>ACTIVE</code> or <code>FROZEN</code>, the members are in the <code>ACTIVE</code> state.</p>
</li>
<li>
<p><strong><code>PASSIVE</code></strong>: In this state, member rejects all operations EXCEPT the read-only ones,
replication and migration operations, heartbeat operations and the join operations as explained
in the <a href="#cluster-states">Cluster States section</a> above.
A member can go into this state when either of the following happens:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Until the member&#8217;s shutdown process is completed after the method <code>Node.shutdown(boolean)</code> is called.
Note that, when the shutdown process is completed, member&#8217;s state changes to <code>SHUT_DOWN</code>.</p>
</li>
<li>
<p>Cluster&#8217;s state is changed to <code>PASSIVE</code> using the method <code>changeClusterState()</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong><code>SHUT_DOWN</code></strong>: A member goes into this state when the member&#8217;s shutdown process is completed.
The member in this state rejects all operations and invocations. A member in this state cannot be restarted.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_member_attributes"><a class="anchor" href="#_defining_member_attributes"></a>Defining Member Attributes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can define various member attributes on your Hazelcast members.
You can use these member attributes to tag your members as may be required by your business logic.</p>
</div>
<div class="paragraph">
<p>To define a member attribute on a member, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide <code>MemberAttributeConfig</code> to your <code>Config</code> object</p>
</li>
<li>
<p>or provide the member attributes at runtime via attribute setter methods on the <code>Member</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you can tag your members with their CPU characteristics and
you can route CPU intensive tasks to those CPU-rich members. Here is how you can do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleMemberAttributes {

    public static void main(String[] args) {
        MemberAttributeConfig fourCore = new MemberAttributeConfig();
        memberAttributeConfig.setAttribute( "CPU_CORE_COUNT", "4" );
        MemberAttributeConfig twelveCore = new MemberAttributeConfig();
        memberAttributeConfig.setAttribute( "CPU_CORE_COUNT", "12" );
        MemberAttributeConfig twentyFourCore = new MemberAttributeConfig();
        memberAttributeConfig.setAttribute( "CPU_CORE_COUNT", "24" );

        Config member1Config = new Config();
        config.setMemberAttributeConfig( fourCore );
        Config member2Config = new Config();
        config.setMemberAttributeConfig( twelveCore );
        Config member3Config = new Config();
        config.setMemberAttributeConfig( twentyFourCore );

        HazelcastInstance member1 = Hazelcast.newHazelcastInstance( member1Config );
        HazelcastInstance member2 = Hazelcast.newHazelcastInstance( member2Config );
        HazelcastInstance member3 = Hazelcast.newHazelcastInstance( member3Config );

        IExecutorService executorService = member1.getExecutorService( "processor" );

        executorService.execute( new CPUIntensiveTask(), new MemberSelector() {
            @Override
            public boolean select(Member member) {
                int coreCount = Integer.parseInt(member.getAttribute( "CPU_CORE_COUNT" ));
                // Task will be executed at either member2 or member3
                if ( coreCount &gt; 8 ) {
                    return true;
                }
                return false;
            }
        } );

        HazelcastInstance member4 = Hazelcast.newHazelcastInstance();
        // We can also set member attributes at runtime.
        member4.setAttribute( "CPU_CORE_COUNT", "2" );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For another example, you can tag some members with a filter so that
a member in the cluster can load classes from those tagged members.
See the <a href="#member-user-code-deployment">User Code Deployment section</a> for more information.</p>
</div>
<div class="paragraph">
<p>You can also define your member attributes through declarative configuration and
start your member afterwards. Here is how you can use the declarative approach:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;member-attributes&gt;
        &lt;attribute name="CPU_CORE_COUNT"&gt;4&lt;/attribute-name&gt;
    &lt;/member-attributes&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  member-attributes:
    CPU_CORE_COUNT:
      type: int
      value: 4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_safety_checking_cluster_members"><a class="anchor" href="#_safety_checking_cluster_members"></a>Safety Checking Cluster Members</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prevent data loss when shutting down a cluster member, Hazelcast provides
a graceful shutdown feature. You perform this shutdown by calling the method <code>HazelcastInstance.shutdown()</code>.</p>
</div>
<div class="paragraph">
<p>The oldest cluster member migrates all of the replicas owned by
the shutdown-requesting member to the other running (not initiated shutdown) cluster members.
After these migrations are completed, the shutting down member will not be the owner or
a backup of any partition anymore. It means that you can shutdown any number of Hazelcast members
in a cluster concurrently with no data loss.</p>
</div>
<div class="paragraph">
<p>Please note that the process of shutting down members waits for
a predefined amount of time for the oldest member to migrate their partition replicas.
You can specify this graceful shutdown timeout duration using the property <code>hazelcast.graceful.shutdown.max.wait</code>.
Its default value is 10 minutes. If migrations are not completed within this duration,
shutdown may continue non-gracefully and lead to data loss.
Therefore, you should choose your own timeout duration considering the size of data in your cluster.</p>
</div>
<div class="sect2">
<h3 id="_ensuring_safe_state_with_partitionservice"><a class="anchor" href="#_ensuring_safe_state_with_partitionservice"></a>Ensuring Safe State with PartitionService</h3>
<div class="paragraph">
<p>With the improvements in graceful shutdown procedure in Hazelcast 3.7,
the following methods are not needed to perform graceful shutdown.
Nevertheless, you can use them to check the current safety status of the partitions in your cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface PartitionService {
   ...
   ...
    boolean isClusterSafe();
    boolean isMemberSafe(Member member);
    boolean isLocalMemberSafe();
    boolean forceLocalMemberToBeSafe(long timeout, TimeUnit unit);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>isClusterSafe</code> checks whether the cluster is in a safe state.
It returns <code>true</code> if there are no active partition migrations and all backups are in sync for each partition.</p>
</div>
<div class="paragraph">
<p>The method <code>isMemberSafe</code> checks whether a specific member is in a safe state.
It checks if all backups of partitions of the given member are in sync with the primary ones.
Once it returns <code>true</code>, the given member is safe and it can be shut down without data loss.</p>
</div>
<div class="paragraph">
<p>Similarly, the method <code>isLocalMemberSafe</code> does the same check for the local member.
The method <code>forceLocalMemberToBeSafe</code> forces the owned and backup partitions to be synchronized,
making the local member safe.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/monitoring/cluster-safety" target="_blank" rel="noopener">here</a>
for more <code>PartitionService</code> code samples.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/deploy/cluster_utilities.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
