<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hazelcast Hazelcast Documentation</title>
    <link rel="canonical" href="https://JakeSCahill.github.io/hazelcast/4.1/deploy/tuning.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://JakeSCahill.github.io">Hazelcast Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Use cases</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">GitHub</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../develop/hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="management.html">Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../home/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a class="git" href="file:///C:/Users/Jake%20Cahill/Documents/code-playground/docs/hazelcast-docs/modules/deploy/pages/tuning.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect2">
<h3 id="tuning-wr"><a class="anchor" href="#tuning-wr"></a>Fine-Tuning WAN Replication</h3>
<div class="paragraph">
<p>WAN Replication will work fine for most use cases with the default settings. However, there are some specific
use cases where you might want to change the behavior of WAN Replication to suit your needs. You might also
be interested in the details how WAN Replication works. If that is the case, this section is for you.</p>
</div>
<div class="sect3">
<h4 id="_batch_size"><a class="anchor" href="#_batch_size"></a>Batch Size</h4>
<div class="paragraph">
<p>The maximum size of events that are sent in a single batch can be changed depending on your needs.
The batch of events is not sent until this size is reached or enough time has elapsed. The default value for batch size is <code>500</code>.
The batch size can be set for each WAN publisher separately by modifying the related <code>WanBatchPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>Below is the configuration for changing the value of the element:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;batch-size&gt;1000&lt;/batch-size&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        batch-size: 1000</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setBatchSize(1000);
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_batch_maximum_delay"><a class="anchor" href="#_batch_maximum_delay"></a>Batch Maximum Delay</h4>
<div class="paragraph">
<p>When using the built-in WAN batch replication, if the number of WAN replication events generated does not
reach <a href="#batch-size">Batch Size</a>, they are sent to the target cluster after a certain amount of time is passed.
You can set this duration in milliseconds using this batch maximum delay configuration.
Default value of for this duration is 1 second (1000 milliseconds).</p>
</div>
<div class="paragraph">
<p>Maximum delay can be set for each target cluster by modifying related <code>WanBatchPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>You can change this element using the configuration as shown below.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;batch-max-delay-millis&gt;2000&lt;/batch-max-delay-millis&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        batch-max-delay-millis: 2000</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setBatchMaxDelayMillis(2000);
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_response_timeout"><a class="anchor" href="#_response_timeout"></a>Response Timeout</h4>
<div class="paragraph">
<p>After a replication event is sent to the target cluster, the source member waits for
an acknowledgement of the delivery of the event to the target.
If the confirmation is not received inside a timeout duration window, the event is resent to
the target cluster. Default value of this duration is <code>60000</code> milliseconds.</p>
</div>
<div class="paragraph">
<p>You can change this duration depending on your network latency for each target cluster by
modifying related <code>WanBatchPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>Below is an example configuration:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;response-timeout-millis&gt;5000&lt;/response-timeout-millis&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        response-timeout-millis: 5000</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setResponseTimeoutMillis(5000);
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_queue_capacity"><a class="anchor" href="#_queue_capacity"></a>Queue Capacity</h4>
<div class="paragraph">
<p>For clusters with high data mutation rates or with long expected periods of disrupted connectivity between clusters,
you might need to increase the replication queue size. The default queue size for replication queues is <code>10000</code>.
This means, if you have heavy put/update/remove rates or if the target/passive cluster is unavailable for too long,
you might exceed the queue size so that the oldest, not yet replicated, updates might get lost.
Note that a separate queue is used for each WAN Replication configured for IMap and ICache.</p>
</div>
<div class="paragraph">
<p>Queue capacity can be set for each target cluster by modifying the related <code>WanBatchPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>You can change this element using the configuration as shown below.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;queue-capacity&gt;15000&lt;/queue-capacity&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        queue-capacity: 15000</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setQueueCapacity(15000);
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can clear a member&#8217;s WAN replication event queue.
It can be initiated through Management Center&#8217;s
<a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-wan-replication" target="_blank" rel="noopener">Clear Queues action</a> or
Hazelcast’s REST API. Below is the URL for its REST call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://member_ip:port/hazelcast/rest/wan/clearWanQueues</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to add the following URL-encoded parameters to the request in the following order separated by "&amp;";</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster name</p>
</li>
<li>
<p>Cluster password</p>
</li>
<li>
<p>Name of the WAN replication configuration</p>
</li>
<li>
<p>WAN replication publisher ID/target cluster name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This may be useful, for instance, to release the consumed heap if you know that
the target cluster is being shut down, decommissioned, put out of use and it will never come back.
Or, when a failure happens and queues are not replicated anymore, you could clear the queues using this clearing action.</p>
</div>
</div>
<div class="sect3">
<h4 id="_queue_full_behavior"><a class="anchor" href="#_queue_full_behavior"></a>Queue Full Behavior</h4>
<div class="paragraph">
<p>You can also configure the policy to be applied when the WAN Replication event queues are full. The following policies
are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISCARD_AFTER_MUTATION</code>: If you select this option, the new WAN events generated by
the member are dropped and not replicated to the target cluster
when the WAN event queues are full.</p>
</li>
<li>
<p><code>THROW_EXCEPTION</code>: If you select this option, the WAN queue size is checked before
each supported mutating operation (like <code>IMap.put()</code>, <code>ICache.put()</code>).
If one the queues of target cluster is full, <code>WanReplicationQueueFullException</code> is thrown and
the operation is not allowed.</p>
</li>
<li>
<p><code>THROW_EXCEPTION_ONLY_IF_REPLICATION_ACTIVE</code>: Its effect is similar to that of <code>THROW_EXCEPTION</code>.
But, it  throws exception only when WAN replication is active. It discards the new events if WAN replication is stopped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example configuration:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;queue-full-behavior&gt;DISCARD_AFTER_MUTATION&lt;/queue-full-behavior&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        queue-full-behavior: DISCARD_AFTER_MUTATION</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setQueueFullBehavior("DISCARD_AFTER_MUTATION");
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>queue-full-behavior</code> configuration is optional. Its default value is <code>DISCARD_AFTER_MUTATION</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment_types"><a class="anchor" href="#_acknowledgment_types"></a>Acknowledgment Types</h4>
<div class="paragraph">
<p>WAN replication supports different acknowledgment (ACK) types for each target cluster. You can choose from two different
acknowledgement types depending on your consistency and performance requirements. The following ACK types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ACK_ON_RECEIPT</code>: A batch of replication events is considered successfully replicated as soon as it is received by
the target cluster. This option does not guarantee that the received update is actually applied but it is faster.</p>
</li>
<li>
<p><code>ACK_ON_OPERATION_COMPLETE</code>: This option guarantees that the event is received by the target cluster and it is
applied. It is more time consuming but it ensures that the updates have been successfully applied by the target cluster
before sending the next batch of events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example configuration:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;acknowledge-type&gt;ACK_ON_OPERATION_COMPLETE&lt;/acknowledge-type&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        acknowledge-type: ACK_ON_OPERATION_COMPLETE</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JAVA</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WanReplicationConfig wanConfig = config.getWanReplicationConfig("london-wan-rep");
WanBatchPublisherConfig publisherConfig = new WanBatchPublisherConfig()
        .setClusterName("london")
        .setAcknowledgeType("ACK_ON_OPERATION_COMPLETE");
wanConfig.addWanPublisherConfig(publisherConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>acknowledge-type</code> configuration is optional. Its default value is <code>ACK_ON_OPERATION_COMPLETE</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_key_based_coalescing"><a class="anchor" href="#_key_based_coalescing"></a>Key-based Coalescing</h4>
<div class="paragraph">
<p>By default, WAN Replication will replicate all of the updates on map and cache entries. If you are updating a
single "hot" entry multiple times, WAN Replication will send an update event for every entry update. If you don&#8217;t need
to have all updates replicated and would like to simply replicate the latest update for a certain entry, you can
turn on key-based coalescing, thus saving on amounts of data replicated between clusters.</p>
</div>
<div class="paragraph">
<p>The following is an example configuration:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;snapshot-enabled&gt;true&lt;/snapshot-enabled&gt;
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        snapshot-enabled: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>snapshot-enabled</code> is optional. Its default value is <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="low-latency-higher-throughput"><a class="anchor" href="#low-latency-higher-throughput"></a>Achieving Lower Latencies and Higher Throughput</h4>
<div class="paragraph">
<p>The WAN replication mechanism allows
tuning for lower latencies of replication and higher throughput.
In most cases, WAN replication is sufficient with out-of-the-box settings which cause
WAN replication to replicate the map and cache events with little overhead.
However, there might be some use cases where the latency between a map/cache mutation on one cluster and
its visibility on the other cluster must be kept within some bounds.
To achieve such demands, you can first try tuning the WAN replication mechanism using the following publisher elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>batch-size</code></p>
</li>
<li>
<p><code>batch-max-delay-millis</code></p>
</li>
<li>
<p><code>idle-min-park-ns</code></p>
</li>
<li>
<p><code>idle-max-park-ns</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To understand the implications of these elements, let&#8217;s first dive into how WAN replication works.</p>
</div>
<div class="paragraph">
<p>WAN replication runs in a separate thread and tries to send map and cache mutation events in batches to
the target endpoints for higher throughput. The target endpoints are usually members in
a target Hazelcast cluster but different WAN implementations may have different target endpoints.
The event batch is collected by iterating over the WAN queues for different partitions and, different maps and caches.
WAN replication tries and collects a batch of a size which can be configured using the <code>batch-size</code> element.</p>
</div>
<div class="paragraph">
<p>If enough time has passed and the WAN replication thread hasn&#8217;t collected enough events to fill
a batch, it sends what it has collected nevertheless.
This is controlled by the <code>batch-max-delay-millis</code> element.
The "enough time" precisely means that more than the configured amount of milliseconds has passed since
the time the last batch was sent to any target endpoint.</p>
</div>
<div class="paragraph">
<p>If there are no events in any of the WAN queues, the WAN replication thread goes into
the idle state by parking the WAN replication thread.
The minimum park time can be defined using the <code>idle-min-park-ns</code> element and
the maximum park time can be controlled using the <code>idle-max-park-ns</code> element.
If a WAN event is enqueued while the WAN replication thread is in the idle state, the latency for replication of that WAN event increases.</p>
</div>
<div class="paragraph">
<p>An example WAN replication configuration using the default values of the above elements is shown below.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep-batch"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;batch-size&gt;500&lt;/batch-size&gt;
            &lt;batch-max-delay-millis&gt;1000&lt;/batch-max-delay-millis&gt;
            &lt;idle-min-park-ns&gt;10000000&lt;/idle-min-park-ns&gt; &lt;!-- 10 ms --&gt;
            &lt;idle-max-park-ns&gt;250000000&lt;/idle-max-park-ns&gt; &lt;!-- 250 ms --&gt;
            ...
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep:
      batch-publisher:
        cluster-name: london
        batch-size: 500
        batch-max-delay-millis: 1000
        idle-min-park-ns: 10000000
        idle-max-park-ns: 250000000</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will now discuss tuning these elements. Unfortunately, the exact tuning parameters heavily depend
on the load, mutation rate, latency between the source and target clusters and even use cases.
We will thus discuss some general approaches and pointers.</p>
</div>
<div class="paragraph">
<p>When tuning for low latency, the first thing you might want to do is lower
the <code>idle-min-park-ns</code> and <code>idle-max-park-ns</code> element values.
This will affect the latencies that you see when having a low number of
operations per second, since this is when the WAN replication thread will be mostly in idle state.
Try lowering both elements but keep in mind that the lower the element value, the more time the WAN replication thread will
spend consuming CPU in a quiescent state - when there is no mutation on the maps or caches.</p>
</div>
<div class="paragraph">
<p>The next element you might lower is the <code>batch-max-delay-millis</code>. If you have a strict upper bound on
the latency for WAN replication, this element must be below that limit. Setting this value too low might
adversely affect the performance: in that case the WAN replication thread might send
smaller batches than what it would if the element was higher and it had waited for some more time.
You can even try setting this element to zero which instructs the WAN replication thread to
send batches as soon as it is able to collect any events; but keep in mind this will result in
many smaller batches instead of less bigger event batches.</p>
</div>
<div class="paragraph">
<p>When tuning for lower latencies, configuring the <code>batch-size</code> usually has little effect, especially at lower mutation rates.
At a low number of operations per second,  the event batches will usually be very small since
the WAN replication thread will not be able to collect the full batch and respect the required latencies for replication.
The <code>batch-size</code> element might have more effect at higher mutation rates. Here, you will probably want to use
bigger batches to avoid paying for the latencies when sending lots of smaller batches, so try increasing
the batch size and benchmarking at high load.</p>
</div>
<div class="paragraph">
<p>There are a couple of other configuration values that you might try changing but it depends on your use case.
The first one is adding a separate configuration for a WAN replication executor.
Collecting of WAN event batches and processing the responses from the target endpoints are done on a shared executor.
This executor is shared between the other parts of the Hazelcast system and all of the WAN replication publishers will use
the same executor. In some cases, you might want to create a dedicated executor for all WAN replication publishers.
The name of this executor is <code>hz:wan</code>. Below is an example of a concrete, dedicated executor for WAN replication.
See the <a href="#configuring-executor-service">Configuring Executor Service section</a> for more information on
the configuration options of the executor.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;executor-service name="hz:wan"&gt;
        &lt;pool-size&gt;16&lt;/pool-size&gt;
    &lt;/executor-service&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  executor-service:
    hz-wan:
      pool-size: 16</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last two elements that you might want to change are <code>acknowledge-type</code> and <code>max-concurrent-invocations</code>.
Changing these elements allow you to get a greater throughput at the expense of event ordering.
This means that these elements may only be changed if your application can tolerate WAN events to be received out-of-order.
For instance, if you are updating or removing the existing map or cache entries, an out-of-order WAN event delivery would mean
that the event for the entry removal or update might be processed by the target cluster before the event is received to create that entry.
This does not causes exceptions but it causes the clusters to fall out-of-sync.
In these cases, you most probably will not be able to use these elements.
On the other hand, if you are only creating new, immutable entries (which are then removed by the expiration mechanism),
you can use these elements to achieve a greater throughput.</p>
</div>
<div class="paragraph">
<p>The <code>acknowledge-type</code> element controls at which time the target cluster will send a response for the received WAN event batch.
The default value is <code>ACK_ON_OPERATION_COMPLETE</code> which will ensure that all events are processed before
the response is sent to the source cluster.
The value <code>ACK_ON_RECEIPT</code> instructs the target cluster to send a response as soon as
it has received the WAN event batch but before it has been processed.
This has two implications. One is that events can now be processed out-of-order (see the previous paragraph) and
the other is that the exceptions thrown on processing the WAN event batch will not be received by
the source cluster and the WAN event batch will not be retried.
As such, some events might get lost in case of errors and the clusters may fall out-of-sync.
WAN sync can help bring those clusters in-sync.
The benefit of the <code>ACK_ON_RECEIPT</code> value is that now the source cluster can
send a new batch sooner, without waiting for the previous batch to be processed fully.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WAN synchronization strategies (neither the default nor the <a href="#delta-wan-synchronization">[delta-wan-synchronization]</a>)
don&#8217;t synchronize the deletions since they are not yet tracked under WAN.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>max-concurrent-invocations</code> element controls the maximum number of
WAN event batches being sent to the target cluster concurrently.
Setting this element to anything less than 2 will only allow a single batch of
events to be sent to each target endpoint and will maintain causality of events for
a single partition (events are not received out-of-order).
Setting this element to 2 or higher will allow multiple batches of WAN events to be sent to
each target endpoint. Since this allows reordering of batches due to the network conditions, causality and
ordering of events for a single partition is lost and batches for a single partition are now sent randomly to
any available target endpoint. This, however, does present a faster WAN replication for certain scenarios such as
replicating immutable, independent map entries which are only added once and where
ordering, when these entries are added, is not necessary.
Keep in mind that if you set this element to a value which is less than the target endpoint count,
you will lose performance as not all target endpoints will be used at any point in time to process the WAN event batches.
So, for instance, if you have a target cluster with 3 members (target endpoints) and you want to use
this element, it only makes sense to set it to a value higher than 3. Otherwise, you can simply disable it by
setting it to less than 2 in which case WAN will use the default replication strategy and adapt to
the target endpoint count while maintaining causality.</p>
</div>
<div class="paragraph">
<p>An example WAN replication configuration using the default values of
the aforementioned elements is shown below.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep-batch"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;acknowledge-type&gt;ACK_ON_OPERATION_COMPLETE&lt;/acknowledge-type&gt;
            &lt;max-concurrent-invocations&gt;-1&lt;/max-concurrent-invocations&gt;
            ...
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep-batch:
      cluster-name: london
      acknowledge-type: ACK_ON_OPERATION_COMPLETE
      max-concurrent-invocations: -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, as we&#8217;ve mentioned, the exact values which will give you the optimal performance depend on your environment and use case.
Please benchmark and try out different values to find out the right values for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discovery_period"><a class="anchor" href="#_discovery_period"></a>Discovery Period</h4>
<div class="paragraph">
<p>When using WAN Replication with Discovery SPI, you can set the period in seconds in which WAN tries to
discover new target endpoints and reestablish connections to failed endpoints using the <code>discovery-period-seconds</code>
property. The default value is 10 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep-batch"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;discovery-period-seconds&gt;20&lt;/discovery-period-seconds&gt;
            ...
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maximum_number_of_target_endpoints"><a class="anchor" href="#_maximum_number_of_target_endpoints"></a>Maximum Number of Target Endpoints</h4>
<div class="paragraph">
<p>When using WAN Replication with Discovery SPI, you can set the maximum number of endpoints that WAN connects to
at any point using the <code>max-target-endpoints</code> property. This element has no effect when static endpoint addresses
are defined using <code>target-endpoints</code>. Default is <code>Integer.MAX_VALUE</code>.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep-batch"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;max-target-endpoints&gt;5&lt;/max-target-endpoints&gt;
            ...
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep-batch:
      batch-publisher:
        cluster-name: london
        max-target-endpoints: 5</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_endpoint_private_address"><a class="anchor" href="#_use_endpoint_private_address"></a>Use Endpoint Private Address</h4>
<div class="paragraph">
<p>When using WAN Replication with Discovery SPI, you can set whether the WAN connection manager should connect to the
endpoint on the private address returned by the Discovery SPI using the <code>use-endpoint-private-address</code> property.
By default this element is <code>false</code> which means the WAN connection manager always uses the public address.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;wan-replication name="london-wan-rep-batch"&gt;
        &lt;batch-publisher&gt;
            &lt;cluster-name&gt;london&lt;/cluster-name&gt;
            &lt;use-endpoint-private-address&gt;true&lt;/use-endpoint-private-address&gt;
            ...
        &lt;/batch-publisher&gt;
    &lt;/wan-replication&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  wan-replication:
    london-wan-rep-batch:
      batch-publisher:
        cluster-name: london
        use-endpoint-private-address: true</code></pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/deploy/tuning.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
