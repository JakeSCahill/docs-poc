<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hazelcast Hazelcast Documentation</title>
    <link rel="canonical" href="https://JakeSCahill.github.io/hazelcast/4.1/develop/distributed_events.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://JakeSCahill.github.io">Hazelcast Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Use cases</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">GitHub</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploy/installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/management.html">Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../home/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../hazelcast_overview.html">Hazelcast IMDG</a></li>
    <li><a href="hazelcast_clients.html">Develop Solutions</a></li>
    <li><a href="distributed_events.html">Distributed Events</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a class="git" href="file:///C:/Users/Jake%20Cahill/Documents/code-playground/docs/hazelcast-docs/modules/develop/pages/distributed_events.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="distributed-events"><a class="anchor" href="#distributed-events"></a>Distributed Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register for Hazelcast entry events so you are notified
when those events occur. Event listeners are cluster-wide: when a
listener is registered in one member of cluster, it is actually
registered for the events that originated at any member in the cluster.
When a new member joins, events originated at the new member are also delivered.</p>
</div>
<div class="paragraph">
<p>An event is created only if you registered an event listener. If no listener
is registered, then no event is created. If you provided a predicate
when you registered the event listener, pass the predicate before sending
the event to the listener (member/client).</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, your event listener should not implement heavy processes
in its event methods that block the thread for a long time. If needed, you can
use <code>ExecutorService</code> to transfer long running processes to another thread and
thus offload the current listener thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a failover scenario, events are not highly available and may get lost.
However, you can perform workarounds such as configuring the event queue capacity
as explained in the <a href="#global-event-configuration">Global Event Configuration section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hazelcast offers the following event listeners.</p>
</div>
<div class="paragraph">
<p>For cluster events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Membership Listener</strong> for cluster membership events</p>
</li>
<li>
<p><strong>Distributed Object Listener</strong> for distributed object creation and destruction events</p>
</li>
<li>
<p><strong>Migration Listener</strong> for partition migration start and completion events</p>
</li>
<li>
<p><strong>Partition Lost Listener</strong> for partition lost events</p>
</li>
<li>
<p><strong>Lifecycle Listener</strong> for <code>HazelcastInstance</code> lifecycle events</p>
</li>
<li>
<p><strong>Client Listener</strong> for client connection events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For distributed object events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Entry Listener</strong> for <code>IMap</code> and <code>MultiMap</code> entry events</p>
</li>
<li>
<p><strong>Item Listener</strong> for <code>IQueue</code>, <code>ISet</code> and <code>IList</code> item events</p>
</li>
<li>
<p><strong>Message Listener</strong> for <code>ITopic</code> message events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Hazelcast JCache implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#cacheentrylistener">Cache Entry Listener</a></p>
</li>
<li>
<p><a href="#icache-partition-lost-listener">ICache Partition Lost Listener</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Hazelcast clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lifecycle Listener</strong></p>
</li>
<li>
<p><strong>Membership Listener</strong></p>
</li>
<li>
<p><strong>Distributed Object Listener</strong></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cluster-events"><a class="anchor" href="#cluster-events"></a>Cluster Events</h3>
<div class="sect3">
<h4 id="listening-for-member-events"><a class="anchor" href="#listening-for-member-events"></a>Listening for Member Events</h4>
<div class="paragraph">
<p>The Membership Listener interface has methods that are invoked
for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memberAdded</code>: A new member is added to the cluster.</p>
</li>
<li>
<p><code>memberRemoved</code>: An existing member leaves the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To write a Membership Listener class, you implement the MembershipListener
interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Membership Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ClusterMembershipListener implements MembershipListener {

    public void memberAdded(MembershipEvent membershipEvent) {
        System.err.println("Added: " + membershipEvent);
    }

    public void memberRemoved(MembershipEvent membershipEvent) {
        System.err.println("Removed: " + membershipEvent);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a respective event is fired, the membership listener outputs the
addresses of the members that joined and left, and also which attribute
changed on which member.</p>
</div>
<div class="sect4">
<h5 id="registering-membership-listeners"><a class="anchor" href="#registering-membership-listeners"></a>Registering Membership Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include the
membership listener. Below is an example using the method <code>addMembershipListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getCluster().addMembershipListener( new ClusterMembershipListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
listeners in the configuration. You can register listeners using declarative,
programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config config = new Config();
config.addListenerConfig(
new ListenerConfig( "com.yourpackage.ClusterMembershipListener" ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.ClusterMembershipListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.ClusterMembershipListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:listeners&gt;
    &lt;hz:listener class-name="com.yourpackage.ClusterMembershipListener"/&gt;
    &lt;hz:listener implementation="MembershipListener"/&gt;
&lt;/hz:listeners&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-distributed-object-events"><a class="anchor" href="#listening-for-distributed-object-events"></a>Listening for Distributed Object Events</h4>
<div class="paragraph">
<p>The Distributed Object Listener methods <code>distributedObjectCreated</code> and
<code>distributedObjectDestroyed</code> are invoked when a distributed object is
created and destroyed throughout the cluster. To write a Distributed Object
Listener class, you implement the DistributedObjectListener interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Distributed Object Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleDistObjListener implements DistributedObjectListener {

    @Override
    public void distributedObjectCreated(DistributedObjectEvent event) {
        DistributedObject instance = event.getDistributedObject();
        System.out.println("Created " + instance.getName() + ", service=" + instance.getServiceName());
    }

    @Override
    public void distributedObjectDestroyed(DistributedObjectEvent event) {
        System.out.println("Destroyed " + event.getObjectName() + ", service=" + event.getServiceName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a respective event is fired, the distributed object listener
outputs the event type, the object name and a service name
(for example, for a Map object the service name is <code>"hz:impl:mapService"</code>).</p>
</div>
<div class="sect4">
<h5 id="registering-distributed-object-listeners"><a class="anchor" href="#registering-distributed-object-listeners"></a>Registering Distributed Object Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to
include distributed object listeners. Below is an example using
the method <code>addDistributedObjectListener</code>. You can also see this
portion in the above class creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
ExampleDistObjListener example = new ExampleDistObjListener();

hazelcastInstance.addDistributedObjectListener( example );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
the listeners in the configuration. You can register listeners using
declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">config.addListenerConfig(
new ListenerConfig( "com.yourpackage.ExampleDistObjListener" ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.ExampleDistObjListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.ExampleDistObjListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:listeners&gt;
    &lt;hz:listener class-name="com.yourpackage.ExampleDistObjListener"/&gt;
    &lt;hz:listener implementation="DistributedObjectListener"/&gt;
&lt;/hz:listeners&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-migration-events"><a class="anchor" href="#listening-for-migration-events"></a>Listening for Migration Events</h4>
<div class="paragraph">
<p>The Migration Listener interface has methods that are invoked
for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>migrationStarted</code>: The migration starts. A migration consists of a
group of replica migrations which are planned together. The <code>MigrationState</code>
parameter of the  <code>migrationStarted</code> method shows information about
the migration: start time of the process, number of the planned migrations, etc.</p>
</li>
<li>
<p><code>migrationFinished</code>: The migration finishes. <code>MigrationState</code> parameter
shows the result of the migration: number of the completed migrations,
number of the remaining migrations, total elapsed time, etc.</p>
</li>
<li>
<p><code>replicaMigrationCompleted</code>: A partition replica migration starts.
Method&#8217;s parameter, <code>ReplicaMigrationEvent</code>, shows information about
a replica migration: partition ID, replica index, source and destination
members of the migration and elapsed time for this replica migration.
Also it shows the progress of the overall migration: number of the completed
and remaining replica migrations and total elapsed time.</p>
</li>
<li>
<p><code>replicaMigrationFailed</code>: A partition replica migration fails.
The <code>MigrationEvent</code> parameter shows the information about this replica migration
and overall migration similar to the <code>migrationCompleted</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To write a Migration Listener class, you implement the <code>MigrationListener</code>
interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Migration Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ClusterMigrationListener implements MigrationListener {

    @Override
    public void migrationStarted(MigrationState state) {
        System.out.println("Migration Started: " + state);
    }

    @Override
    public void migrationFinished(MigrationState state) {
        System.out.println("Migration Finished: " + state);
    }

    @Override
    public void replicaMigrationCompleted(ReplicaMigrationEvent event) {
        System.out.println("Replica Migration Completed: " + event);
    }

    @Override
    public void replicaMigrationFailed(ReplicaMigrationEvent event) {
        System.out.println("Replica Migration Failed: " + event);
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_registering_migration_listeners"><a class="anchor" href="#_registering_migration_listeners"></a>Registering Migration Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include
migration listeners. Below is an example using the method <code>addMigrationListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

PartitionService partitionService = hazelcastInstance.getPartitionService();
partitionService.addMigrationListener( new ClusterMigrationListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
the listeners in the configuration. You can register listeners using
declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">config.addListenerConfig(
new ListenerConfig( "com.yourpackage.ClusterMigrationListener" ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.ClusterMigrationListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.ClusterMigrationListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:listeners&gt;
    &lt;hz:listener class-name="com.yourpackage.ClusterMigrationListener"/&gt;
    &lt;hz:listener implementation="MigrationListener"/&gt;
&lt;/hz:listeners&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-partition-lost-events"><a class="anchor" href="#listening-for-partition-lost-events"></a>Listening for Partition Lost Events</h4>
<div class="paragraph">
<p>Hazelcast provides fault-tolerance by keeping multiple copies of your data.
For each partition, one of your cluster members becomes the owner and
some of the other members become replica members, based on your configuration.
Nevertheless, data loss may occur if a few members crash simultaneously.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example with three members: N1, N2, N3 for
a given partition-0. N1 is owner of partition-0. N2 and N3 are the first
and second replicas respectively. If N1 and N2 crash simultaneously,
partition-0 loses its data that is configured with less than two backups.
For instance, if we configure a map with one backup, that map loses its
data in partition-0 since both owner and first replica of partition-0 have
crashed. However, if we configure our map with two backups, it does not
lose any data since a copy of partition-0&#8217;s data for the given map
also resides in N3.</p>
</div>
<div class="paragraph">
<p>The Partition Lost Listener notifies for possible data loss occurrences
with the information of how many replicas are lost for a partition. It
listens to <code>PartitionLostEvent</code> instances. Partition lost events are
dispatched per partition.</p>
</div>
<div class="paragraph">
<p>Partition loss detection is done after a member crash is detected by the
other members and the crashed member is removed from the cluster.
Please note that false-positive <code>PartitionLostEvent</code> instances may be
fired on the network split errors.</p>
</div>
<div class="sect4">
<h5 id="_writing_a_partition_lost_listener_class"><a class="anchor" href="#_writing_a_partition_lost_listener_class"></a>Writing a Partition Lost Listener Class</h5>
<div class="paragraph">
<p>To write a Partition Lost Listener, you implement the PartitionLostListener
interface and its <code>partitionLost</code> method, which is invoked when a partition
loses its owner and all backups.</p>
</div>
<div class="paragraph">
<p>The following is an example Partition Lost Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ConsoleLoggingPartitionLostListener implements PartitionLostListener {
    @Override
    public void partitionLost(PartitionLostEvent event) {
        System.out.println(event);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a <code>PartitionLostEvent</code> is fired, the partition lost listener given
above outputs the partition ID, the replica index that is lost and the
member that has detected the partition loss. The following is an example output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>com.hazelcast.partition.PartitionLostEvent{partitionId=242, lostBackupCount=0,
eventSource=Address[192.168.2.49]:5701}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_registering_partition_lost_listeners"><a class="anchor" href="#_registering_partition_lost_listeners"></a>Registering Partition Lost Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster programmatically
or declaratively to include the partition lost listener. Below is an example
of its programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getPartitionService().addPartitionLostListener( new ConsoleLoggingPartitionLostListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.ConsoleLoggingPartitionLostListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.ConsoleLoggingPartitionLostListener</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-lifecycle-events"><a class="anchor" href="#listening-for-lifecycle-events"></a>Listening for Lifecycle Events</h4>
<div class="paragraph">
<p>The Lifecycle Listener notifies for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STARTING</code>: A member is starting.</p>
</li>
<li>
<p><code>STARTED</code>: A member started.</p>
</li>
<li>
<p><code>SHUTTING_DOWN</code>: A member is shutting down.</p>
</li>
<li>
<p><code>SHUTDOWN</code>: A member&#8217;s shutdown has completed.</p>
</li>
<li>
<p><code>MERGING</code>: A member is merging with the cluster.</p>
</li>
<li>
<p><code>MERGED</code>: A member&#8217;s merge operation has completed.</p>
</li>
<li>
<p><code>CLIENT_CONNECTED</code>: A Hazelcast Client connected to the cluster.</p>
</li>
<li>
<p><code>CLIENT_DISCONNECTED</code>: A Hazelcast Client disconnected from the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example Lifecycle Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class NodeLifecycleListener implements LifecycleListener {
     @Override
     public void stateChanged(LifecycleEvent event) {
         System.err.println(event);
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This listener is local to an individual member. It notifies the
application that uses Hazelcast about the events mentioned above
for a particular member.</p>
</div>
<div class="sect4">
<h5 id="_registering_lifecycle_listeners"><a class="anchor" href="#_registering_lifecycle_listeners"></a>Registering Lifecycle Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to
include lifecycle listeners. Below is an example using the method
<code>addLifecycleListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getLifecycleService().addLifecycleListener( new NodeLifecycleListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
the listeners in the configuration. You can register listeners using
declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">config.addListenerConfig(
    new ListenerConfig( "com.yourpackage.NodeLifecycleListener" ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.NodeLifecycleListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.NodeLifecycleListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:listeners&gt;
    &lt;hz:listener class-name="com.yourpackage.NodeLifecycleListener"/&gt;
    &lt;hz:listener implementation="LifecycleListener"/&gt;
&lt;/hz:listeners&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-clients"><a class="anchor" href="#listening-for-clients"></a>Listening for Clients</h4>
<div class="paragraph">
<p>The client listener is used by the Hazelcast cluster members.
It notifies the cluster member when a client is connected to or
disconnected from it, i.e., the clients fire an event from only one member
they are connected to. Other cluster members do not fire a "client is connected"
or "client is disconnected" event.</p>
</div>
<div class="paragraph">
<p>To write a client listener class, you implement the <code>ClientListener</code>
interface and its methods <code>clientConnected</code> and <code>clientDisconnected</code>,
which are invoked when a client is connected to or disconnected from the
cluster. You can add your client listener as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">hazelcastInstance.getClientService().addClientListener(new ExampleClientListener());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;listeners&gt;
        &lt;listener&gt;
            com.yourpackage.ExampleClientListener
        &lt;/listener&gt;
    &lt;/listeners&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  listeners:
    - com.yourpackage.ExampleClientListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:listeners&gt;
    &lt;hz:listener class-name="com.yourpackage.ExampleClientListener"/&gt;
    &lt;hz:listener implementation="com.yourpackage.ExampleClientListener"/&gt;
&lt;/hz:listeners&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also add event listeners to a Hazelcast client. See the
<a href="#configuring-client-listeners">Client Listenerconfig section</a> for the
related information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distributed-object-events"><a class="anchor" href="#distributed-object-events"></a>Distributed Object Events</h3>
<div class="sect3">
<h4 id="_listening_for_map_events"><a class="anchor" href="#_listening_for_map_events"></a>Listening for Map Events</h4>
<div class="paragraph">
<p>You can listen to map-wide or entry-based events using the listeners
provided by the Hazelcast&#8217;s eventing framework. To listen to these events,
implement a <code>MapListener</code> sub-interface.</p>
</div>
<div class="paragraph">
<p>A map-wide event is fired as a result of a map-wide operation. For
example, <code>IMap.clear()</code> or <code>IMap.evictAll()</code>.
An entry-based event is fired after the operations that affect a
specific entry. For example, <code>IMap.remove()</code> or <code>IMap.evict()</code>.</p>
</div>
<div class="sect4">
<h5 id="_catching_a_map_event"><a class="anchor" href="#_catching_a_map_event"></a>Catching a Map Event</h5>
<div class="paragraph">
<p>To catch an event, you should explicitly
implement a corresponding sub-interface of a <code>MapListener</code>,
such as <code>EntryAddedListener</code> or <code>MapClearedListener</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>EntryListener</code> interface still can be implemented (we kept
it for backward compatibility reasons). However, if you need to listen to a
different event, one that is not available in the <code>EntryListener</code> interface, you should also
implement a relevant <code>MapListener</code> sub-interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the following class example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Listen {

    public static void main( String[] args ) {
        HazelcastInstance hz = Hazelcast.newHazelcastInstance();
        IMap&lt;String, String&gt; map = hz.getMap( "somemap" );
        map.addEntryListener( new MyEntryListener(), true );
        System.out.println( "EntryListener registered" );
    }

    static class MyEntryListener implements
            EntryAddedListener&lt;String, String&gt;,
            EntryRemovedListener&lt;String, String&gt;,
            EntryUpdatedListener&lt;String, String&gt;,
            EntryEvictedListener&lt;String, String&gt;,
            EntryLoadedListener&lt;String,String&gt;,
            MapEvictedListener,
            MapClearedListener   {
        @Override
        public void entryAdded( EntryEvent&lt;String, String&gt; event ) {
            System.out.println( "Entry Added:" + event );
        }

        @Override
        public void entryRemoved( EntryEvent&lt;String, String&gt; event ) {
            System.out.println( "Entry Removed:" + event );
        }

        @Override
        public void entryUpdated( EntryEvent&lt;String, String&gt; event ) {
            System.out.println( "Entry Updated:" + event );
        }

        @Override
        public void entryEvicted( EntryEvent&lt;String, String&gt; event ) {
            System.out.println( "Entry Evicted:" + event );
        }

        @Override
        public void entryLoaded( EntryEvent&lt;String, String&gt; event ) {
            System.out.println( "Entry Loaded:" + event );
        }

        @Override
        public void mapEvicted( MapEvent event ) {
            System.out.println( "Map Evicted:" + event );
        }

        @Override
        public void mapCleared( MapEvent event ) {
            System.out.println( "Map Cleared:" + event );
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s perform some modifications on the map entries using the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ModifyMap {

    public static void main( String[] args ) {
        HazelcastInstance hz = Hazelcast.newHazelcastInstance();
        IMap&lt;String, String&gt; map = hz.getMap( "somemap");
        String key = "" + System.nanoTime();
        String value = "1";
        map.put( key, value );
        map.put( key, "2" );
        map.delete( key );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you execute the <code>Listen</code> class and then the <code>Modify</code> class, you get the following output
produced by the <code>Listen</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Entry Added:EntryEvent{entryEventType=ADDED, member=Member [192.168.1.100]]:5702
 - ffedb655-bbad-43ea-aee8-d429d37ce528, name='somemap', key=11455268066242,
 oldValue=null, value=1, mergingValue=null}

Entry Updated:EntryEvent{entryEventType=UPDATED, member=Member [192.168.1.100]]:5702
 - ffedb655-bbad-43ea-aee8-d429d37ce528, name='somemap', key=11455268066242,
 oldValue=1, value=2, mergingValue=null}

Entry Removed:EntryEvent{entryEventType=REMOVED, member=Member [192.168.1.100]]:5702
 - ffedb655-bbad-43ea-aee8-d429d37ce528, name='somemap', key=11455268066242,
 oldValue=null, value=null, mergingValue=null}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the method <code>IMap.clear()</code> does not fire an
"EntryRemoved" event, but fires a "MapCleared" event.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Listeners have to offload all blocking operations to another thread (pool).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listening_for_lost_map_partitions"><a class="anchor" href="#_listening_for_lost_map_partitions"></a>Listening for Lost Map Partitions</h4>
<div class="paragraph">
<p>You can listen to <code>MapPartitionLostEvent</code> instances by registering an implementation
of <code>MapPartitionLostListener</code>, which is also a sub-interface of <code>MapListener</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ListenMapPartitionLostEvents {

    public static void main(String[] args) {
        Config config = new Config();
        // keeps its data if a single node crashes
        config.getMapConfig("map").setBackupCount(1);

        HazelcastInstance instance = HazelcastInstanceFactory.newHazelcastInstance(config);

        IMap&lt;Object, Object&gt; map = instance.getMap("map");
        map.put(0, 0);

        map.addPartitionLostListener(new MapPartitionLostListener() {
            @Override
            public void partitionLost(MapPartitionLostEvent event) {
                System.out.println(event);
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within this example code, a <code>MapPartitionLostListener</code> implementation is registered to a map
that is configured with one backup. For this particular map and any of the partitions in the
system, if the partition owner member and its first backup member crash simultaneously, the
given <code>MapPartitionLostListener</code> receives a
corresponding <code>MapPartitionLostEvent</code>. If only a single member crashes in the cluster,
there is no <code>MapPartitionLostEvent</code> fired for this map since backups for the partitions
owned by the crashed member are kept on other members.</p>
</div>
<div class="paragraph">
<p>See the <a href="#listening-for-partition-lost-events">Listening for Partition Lost Events section</a> for more
information about partition lost detection and partition lost events.</p>
</div>
<div class="sect4">
<h5 id="_registering_map_listeners"><a class="anchor" href="#_registering_map_listeners"></a>Registering Map Listeners</h5>
<div class="paragraph">
<p>After you create your listener class, you can configure your cluster
to include map listeners using the method <code>addEntryListener</code> (as you
can see in the example <code>Listen</code> class above). Below is the related portion
from this code, showing how to register a map listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hz = Hazelcast.newHazelcastInstance();
IMap&lt;String, String&gt; map = hz.getMap( "somemap" );
map.addEntryListener( new MyEntryListener(), true );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
listeners in configuration. You can register listeners using declarative,
programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">mapConfig.addEntryListenerConfig(
new EntryListenerConfig( "com.yourpackage.MyEntryListener",
                                 false, false ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;map name="somemap"&gt;
        &lt;entry-listeners&gt;
            &lt;entry-listener include-value="false" local="false"&gt;
                com.yourpackage.MyEntryListener
            &lt;/entry-listener&gt;
        &lt;/entry-listeners&gt;
    &lt;/map&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  somemap:
    map:
      entry-listeners:
        - class-name: com.your-package.MyEntryListener
          include-value: false
          local: false</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:map name="somemap"&gt;
    &lt;hz:entry-listeners&gt;
        &lt;hz:entry-listener include-value="true"
            class-name="com.hazelcast.spring.DummyEntryListener"/&gt;
        &lt;hz:entry-listener implementation="dummyEntryListener" local="true"/&gt;
    &lt;/hz:entry-listeners&gt;
&lt;/hz:map&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_map_listener_attributes"><a class="anchor" href="#_map_listener_attributes"></a>Map Listener Attributes</h5>
<div class="paragraph">
<p>As you see, there are attributes of the map listeners in the above
examples: <code>include-value</code> and <code>local</code>. The attribute <code>include-value</code>
is a boolean attribute that is optional, and if you set it to <code>true</code>,
the map event contains the map value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The attribute <code>local</code> is also a boolean attribute that is optional, and
if you set it to <code>true</code>, you can listen to the map on the local member.
Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listening_for_multimap_events"><a class="anchor" href="#_listening_for_multimap_events"></a>Listening for MultiMap Events</h4>
<div class="paragraph">
<p>You can listen to entry-based events in the MultiMap using <code>EntryListener</code>.
The following is an example entry listener implementation for MultiMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleEntryListener implements EntryListener&lt;String, String&gt; {
    @Override
    public void entryAdded(EntryEvent&lt;String, String&gt; event) {
        System.out.println("Entry Added: " + event);
    }
    @Override
    public void entryRemoved( EntryEvent&lt;String, String&gt; event ) {
        System.out.println( "Entry Removed: " + event );
    }
    @Override
    public void entryUpdated(EntryEvent&lt;String, String&gt; event) {
        System.out.println( "Entry Updated: " + event );
    }
    @Override
    public void entryEvicted(EntryEvent&lt;String, String&gt; event) {
        System.out.println( "Entry evicted: " + event );
    }
    @Override
    public void entryExpired(EntryEvent&lt;String, String&gt; event) {
        System.out.println( "Entry expired: " + event );
    }
    @Override
    public void mapCleared(MapEvent event) {
        System.out.println( "Map Cleared: " + event );
    }
    @Override
    public void mapEvicted(MapEvent event) {
        System.out.println( "Map Evicted: " + event );
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_registering_multimap_listeners"><a class="anchor" href="#_registering_multimap_listeners"></a>Registering MultiMap Listeners</h5>
<div class="paragraph">
<p>After you create your listener class, you can configure your cluster to
include MultiMap listeners using the method <code>addEntryListener</code>. Below
is the related portion from a code, showing how to register a map listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hz = Hazelcast.newHazelcastInstance();
MultiMap&lt;String, String&gt; map = hz.getMultiMap( "somemap" );
map.addEntryListener( new ExampleEntryListener(), true );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
listeners in the configuration. You can register listeners using declarative,
programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">multiMapConfig.addEntryListenerConfig(
  new EntryListenerConfig( "com.yourpackage.ExampleEntryListener",
    false, false ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;multimap name="somemap"&gt;
        &lt;value-collection-type&gt;SET&lt;/value-collection-type&gt;
        &lt;entry-listeners&gt;
            &lt;entry-listener include-value="false" local="false"&gt;
                com.yourpackage.ExampleEntryListener
            &lt;/entry-listener&gt;
        &lt;/entry-listeners&gt;
    &lt;/multimap&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  multimap:
    somemap:
      value-collection: SET
      entry-listeners:
        - class-name: com.your-package.MyEntryListener
          include-value: false
          local: false</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:multimap name="somemap" value-collection-type="SET"&gt;
    &lt;hz:entry-listeners&gt;
        &lt;hz:entry-listener include-value="false"
            class-name="com.yourpackage.ExampleEntryListener"/&gt;
        &lt;hz:entry-listener implementation="EntryListener" local="false"/&gt;
    &lt;/hz:entry-listeners&gt;
&lt;/hz:multimap&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multimap_listener_attributes"><a class="anchor" href="#_multimap_listener_attributes"></a>MultiMap Listener Attributes</h5>
<div class="paragraph">
<p>As you see, there are attributes of the MultiMap listeners in the above
examples: <code>include-value</code> and <code>local</code>. The attribute <code>include-value</code> is
a boolean attribute that is optional, and if you set it to <code>true</code>, the
MultiMap event contains the map value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The attribute <code>local</code> is also a boolean attribute that is optional, and
if you set it to <code>true</code>, you can listen to the MultiMap on the local member.
Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listening_for_item_events"><a class="anchor" href="#_listening_for_item_events"></a>Listening for Item Events</h4>
<div class="paragraph">
<p>The Item Listener is used by the Hazelcast <code>IQueue</code>, <code>ISet</code> and <code>IList</code> interfaces.</p>
</div>
<div class="paragraph">
<p>To write an Item Listener class, you implement the ItemListener
interface and its methods <code>itemAdded</code> and <code>itemRemoved</code>. These methods
are invoked when an item is added or removed.</p>
</div>
<div class="paragraph">
<p>The following is an example Item Listener class for an <code>ISet</code> structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleItemListener implements ItemListener&lt;Price&gt; {

    @Override
    public void itemAdded(ItemEvent&lt;Price&gt; event) {
        System.out.println( "Item added:  " + event );
    }

    @Override
    public void itemRemoved(ItemEvent&lt;Price&gt; event) {
        System.out.println( "Item removed: " + event );
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use <code>ICollection</code> when creating any of the collection
(queue, set and list) data structures, as shown above. You can also
use <code>IQueue</code>, <code>ISet</code> or <code>IList</code> instead of <code>ICollection</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_registering_item_listeners"><a class="anchor" href="#_registering_item_listeners"></a>Registering Item Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include
item listeners. Below is an example using the method <code>addItemListener</code>
for <code>ISet</code> (it applies also to <code>IQueue</code> and <code>IList</code>). You can also see
this portion in the above class creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

ICollection&lt;Price&gt; set = hazelcastInstance.getSet( "default" );
// or ISet&lt;Prices&gt; set = hazelcastInstance.getSet( "default" );
set.addItemListener( new ExampleItemListener(), true );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events
between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register
listeners in the configuration. You can register listeners using
declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">setConfig.addItemListenerConfig(
new ItemListenerConfig( "com.yourpackage.ExampleItemListener", true ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;set&gt;
        &lt;item-listeners&gt;
            &lt;item-listener include-value="true"&gt;
                com.yourpackage.ExampleItemListener
            &lt;/item-listener&gt;
        &lt;/item-listeners&gt;
    &lt;/set&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  set:
    default:
      item-listeners:
        - class-name: com.yourpackage.ExampleItemListener
          include-value: true</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:set name="default" &gt;
    &lt;hz:item-listeners&gt;
        &lt;hz:item-listener include-value="true"
            class-name="com.yourpackage.ExampleItemListener"/&gt;
    &lt;/hz:item-listeners&gt;
&lt;/hz:set&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_item_listener_attributes"><a class="anchor" href="#_item_listener_attributes"></a>Item Listener Attributes</h5>
<div class="paragraph">
<p>As you see, there is an attribute in the above examples: <code>include-value</code>.
It is a boolean attribute that is optional, and if you set it to <code>true</code>,
the item event contains the item value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>There is also another attribute called <code>local</code>, which is not shown in the
above examples. It is also a boolean attribute that is optional, and
if you set it to <code>true</code>, you can listen to the items on the local member.
Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listening_for_topic_messages"><a class="anchor" href="#_listening_for_topic_messages"></a>Listening for Topic Messages</h4>
<div class="paragraph">
<p>The Message Listener is used by the <code>ITopic</code> interface. It notifies
when a message is received for the registered topic.</p>
</div>
<div class="paragraph">
<p>To write a Message Listener class, you implement the MessageListener
interface and its method <code>onMessage</code>, which is invoked
when a message is received for the registered topic.</p>
</div>
<div class="paragraph">
<p>The following is an example Message Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ExampleMessageListener implements MessageListener&lt;MyEvent&gt; {

    public void onMessage( Message&lt;MyEvent&gt; message ) {
        MyEvent myEvent = message.getMessageObject();
        System.out.println( "Message received = " + myEvent.toString() );
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_registering_message_listeners"><a class="anchor" href="#_registering_message_listeners"></a>Registering Message Listeners</h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include
message listeners. Below is an example using the method <code>addMessageListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

ITopic topic = hazelcastInstance.getTopic( "default" );
topic.addMessageListener( new ExampleMessageListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing messaging
events between the creation of the instance and registering the listener.
To overcome this race condition, Hazelcast allows you to register this
listener in the configuration. You can register it using declarative,
programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">topicConfig.addMessageListenerConfig(
  new ListenerConfig( "com.yourpackage.ExampleMessageListener" ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;topic name="default"&gt;
        &lt;message-listeners&gt;
            &lt;message-listener&gt;
                com.yourpackage.ExampleMessageListener
            &lt;/message-listener&gt;
        &lt;/message-listeners&gt;
    &lt;/topic&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  topic:
    default:
      message-listeners:
        - com.yourpackage.ExampleMessageListener</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Spring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:topic name="default"&gt;
    &lt;hz:message-listeners&gt;
        &lt;hz:message-listener
            class-name="com.yourpackage.ExampleMessageListener"/&gt;
    &lt;/hz:message-listeners&gt;
&lt;/hz:topic&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_listeners_for_hazelcast_clients"><a class="anchor" href="#_event_listeners_for_hazelcast_clients"></a>Event Listeners for Hazelcast Clients</h3>
<div class="paragraph">
<p>You can add event listeners to Hazelcast clients.
You can configure the following listeners to listen to the events
on the client side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#listening-for-lifecycle-events">Lifecycle Listener</a>: Notifies
when the client is starting, started, shutting down and shutdown.</p>
</li>
<li>
<p><a href="#listening-for-member-events">Membership Listener</a>: Notifies when
a member joins to/leaves the cluster to which the client is connected,
or when an attribute is changed in a member.</p>
</li>
<li>
<p><a href="#listening-for-distributed-object-events">Distributed Object Listener</a>:
Notifies when a distributed object is created or destroyed throughout
the cluster to which the client is connected. Also notifies for the events
happening in the distributed data structures, e.g., entry, item and message
listeners.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Hazelcast Java client example code/configuration snippets, see the
sections of the current chapter, i.e., <a href="#distributed-events">Distributed Events</a>.
See also the <a href="#configuring-client-listeners">Configuring Client Listeners section</a>
for more information.</p>
</div>
<div class="paragraph">
<p>Follow the below links to learn how to configure the event listeners on other
Hazelcast clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-csharp-client#75-distributed-events" target="_blank" rel="noopener">.NET client</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-cpp-client#75-distributed-events" target="_blank" rel="noopener">C++ client</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-nodejs-client/blob/master/DOCUMENTATION.md#75-distributed-events" target="_blank" rel="noopener">Node.js client</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-go-client#75-distributed-events" target="_blank" rel="noopener">Go client</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-python-client#75-distributed-events" target="_blank" rel="noopener">Python client</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that you can simply add a listener to your client that you already configured
and registered on the member side. You do not need to configure the listener on the client.
Assuming that you implemented a listener for a map, .e.g., <code>MyListener</code> on the member side,
see the following example for a Java client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">IMap&lt;Object, Object&gt; map = client.getMap("mymap");
map.addEntryListener(new MyListener(), true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see, no configuration is needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_global_event_configuration"><a class="anchor" href="#_global_event_configuration"></a>Global Event Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.event.queue.capacity</code>: default value is 1000000</p>
</li>
<li>
<p><code>hazelcast.event.queue.timeout.millis</code>: default value is 250</p>
</li>
<li>
<p><code>hazelcast.event.thread.count</code>: default value is 5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A striped executor in each cluster member controls and dispatches
the received events. This striped executor also guarantees the event
order. For all events in Hazelcast, the order in which events are
generated and the order in which they are published are guaranteed
for given keys. For map and multimap, the order is preserved for the
operations on the same key of the entry. For list, set, topic and queue,
the order is preserved for events on that instance of the distributed
data structure.</p>
</div>
<div class="paragraph">
<p>To achieve the order guarantee, you make only one thread responsible
for a particular set of events (entry events of a key in a map, item
events of a collection, etc.) in <code>StripedExecutor</code> (within <code>com.hazelcast.util.executor</code>).</p>
</div>
<div class="paragraph">
<p>If the event queue reaches its capacity (<code>hazelcast.event.queue.capacity</code>)
and the last item cannot be put into the event queue for the period
specified in <code>hazelcast.event.queue.timeout.millis</code>, these events are
dropped with a warning message, such as "EventQueue overloaded".</p>
</div>
<div class="paragraph">
<p>If event listeners perform a computation that takes a long time, the
event queue can reach its maximum capacity and lose events. For map
and multimap, you can configure <code>hazelcast.event.thread.count</code> to a
higher value so that fewer collisions occur for keys, and therefore
worker threads do not block each other in <code>StripedExecutor</code>. For list, set,
topic and queue, you should offload heavy work to another thread.
To preserve order guarantee, you should implement similar logic with
<code>StripedExecutor</code> in the offloaded thread pool.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/develop/distributed_events.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
